<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/352687b833.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
    <style>
      * {
        font-family: 'Montserrat', sans-serif;
      }

      tr {
        height: 3em;
      }
    </style>
  </head>
  <body class="p-4 text-gray-900 max-w-4xl m-auto">
    <h1 class="text-4xl text-center my-12 font-bold">
      ConsignCloud Businss Cost Calculator
    </h1>
    <div class="my-8 mb-16 p-8 border border-solid border-gray-400
                bg-gray-100 rounded shadow">
      <p class="pb-4">Trying to see what it'll cost to open a consignment store?</p>
      <p>
        Enter your expected itemized costs below, and we'll calculate how much it will
        cost you per month to run - and how soon you'll be profitable.
      </p>
    </div>
    <div class="flex flex-col gap-8">
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl border-b border-solid border-gray-200">
          Business Costs
        </h2>
        <table class="w-full">
          <tbody>
            <tr>
              <td>Lease</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="lease"
                  value="1200" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
              </td>
            </tr>
            <tr>
              <td>
                Business owner's policy
                <a
                  href="https://www.investopedia.com/terms/business-owners-policy.asp"
                  target="_blank"
                  rel="noopener">
                  <i class="fa-solid fa-circle-info text-teal-300 cursor-pointer"></i>
                </a>
              </td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="insurance"
                  value="1200" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/yr</span>
              </td>
            </tr>
            <tr>
              <td>
                Worker's compensation insurance
                <a
                  href="https://www.benzinga.com/money/workers-comp-calculator"
                  target="_blank"
                  rel="noopener">
                  <i class="fa-solid fa-circle-info text-teal-300 cursor-pointer"></i>
                </a>
              </td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="workersComp"
                  value="1275" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/yr</span>
              </td>
            </tr>
            <tr>
              <td>Payroll costs</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="payroll"
                  value="5000" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl border-b border-solid border-gray-200">
          Payment Processing
        </h2>
        <h3 class="text-lg mt-2">What is your average sale amount?</h3>
        <div class="flex">
          <div class="mr-4">$1</div>
          <input
            class="w-full"
            type="range"
            min="1"
            max="1000"
            value="80"
            name="avgSale">
          <div class="ml-4">$1,000</div>
        </div>
        <div id="avgSaleDisplay" class="text-center">$80</div>
        <table class="w-full">
          <tbody>
            <tr>
              <td>Monthly subscription</td>
              <td class="relative text-right">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="paymentSubscription"
                  value="0" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
              </td>
            </tr>
            <tr>
              <td>Flat fee</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="paymentFee"
                  value="0.30"
                  step="0.1" />
              </td>
            </tr>
            <tr>
              <td>Fee rate</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">%</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="paymentRate"
                  value="2.6"
                  step="0.1" />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl border-b border-solid border-gray-200">
          Payout Processing
        </h2>
        <h3 class="mt-2 text-lg">How many payouts do you process per month?</h3>
        <p>
          A quick way to calculate this - take your number of active accounts
          (usually around 20% of the total), and divide by how often you process payouts.
          So for example if you have 30 active accounts, and you pay out once every 3 months,
          you would be processing 10 payouts per month.
        </p>
        <div class="flex">
          <div class="mr-4">10</div>
          <input
            class="w-full"
            type="range"
            min="10"
            max="300"
            value="50"
            name="payoutsPerMonth">
          <div class="ml-4">300</div>
        </div>
        <div id="payoutsPerMonthDisplay" class="text-center">50</div>
        <table class="w-full">
          <tbody>
            <tr>
              <td>Cost per payout</td>
              <td class="relative text-right">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="payoutCost"
                  step="0.01"
                  value="0.50" />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl border-b border-solid border-gray-200">
          Software Subscriptions
        </h2>
        <table class="w-full" id="subscriptions">
          <tbody>
            <tr id="addSubscription">
              <td colspan="2" class="cursor-pointer">
                <span>
                  <i class="fa-solid fa-plus cursor-pointer mx-2"></i> Add a subscription
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl border-b border-solid border-gray-200">
          Your Results
        </h2>
        <div>
          <canvas id="chart"></canvas>
        </div>
        <div class="my-8 mb-16 p-8 border border-solid border-gray-400
                    bg-gray-100 rounded shadow">
          <p class="pb-4">
            The chart above shows how your business costs scale with your sales volume.
          </p>
        </div>
      </div>
    </div>
    <script>
      // Variables

      const $ = s => document.querySelector(s)
      const $$ = s => document.querySelectorAll(s)
      const $chart = $('#chart')
      const $inputs = [].slice.apply($$('input[name]'))
      const $subscriptions = $('#subscriptions')

      // Functions

      const initArray = (l, f) => {
        const a = []

        for (let i = 1; i < l; i++) {
          a.push(f(i))
        }

        return a
      }

      const addCommas = x => x.toString().replace(/(\d)(?=(\d{3})+$)/g, '$1,')

      const getValues = () => {
        const values = {}

        $inputs.forEach($input=> {
          values[$input.name] = parseFloat($input.value)
        })

        return values
      }

      const calculateRevenue = sales => {
        const {avgSale} = getValues()

        return sales
      }

      const calculateCosts = sales => {
        const {
          avgSale, insurance, lease, paymentFee, paymentRate, paymentSubscription,
          payroll, salesVolume, workersComp, payoutsPerMonth, payoutCost,
        } = getValues()

        return (
          avgSale * paymentFee + sales * paymentRate / 100
          + payoutsPerMonth * payoutCost
          + lease + paymentSubscription + payroll
          + (insurance + workersComp) / 12
          + [].slice
            .apply($$('[name="subscription[]"]'))
            .reduce((t, $i) => t + parseFloat($i.value), 0)
        )
      }

      const calculateData = calculateDataPoint =>
        initArray(21, i => calculateDataPoint(i * 1000))

      const updateChart = () => {
        chart.data.datasets[0].data = calculateData(calculateCosts)
        chart.data.datasets[1].data = calculateData(calculateRevenue)

        chart.update()
      }

      const addSubscription = (name = '', amount = 0) => {
        const n = $subscriptions.querySelectorAll('tr').length
        const $tr = document.createElement('tr')

        $tr.innerHTML = `
        <td>
          <i class="fa fa-times cursor-pointer mx-2"></i>
          <input
            class="border border-solid border-gray-400 rounded p-2 w-32 pl-6 w-3/4"
            placeholder="Subscription name"
            value="${name}" />
        </td>
        <td class="relative text-right">
          <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
          <input
            class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
            name="subscription[]"
            type="number"
            value="${amount}" />
          <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
        </td>`

        $tr.querySelector('input[name]').addEventListener('change', updateChart)
        $tr.querySelector('.fa-times').addEventListener('click', () => {
          $tr.remove()

          updateChart()
        })

        $subscriptions.append($tr)
        $subscriptions.append($('#addSubscription'))

        updateChart()
      }

      // Initialization

      $inputs.forEach($input => {
        $input.addEventListener('change', updateChart)
      })

      $('[name=avgSale]').addEventListener('input', e => {
        $('#avgSaleDisplay').innerHTML = `$${addCommas(getValues().avgSale)}`
      })

      $('[name=payoutsPerMonth]').addEventListener('input', e => {
        $('#payoutsPerMonthDisplay').innerHTML = addCommas(getValues().payoutsPerMonth)
      })

      $('#addSubscription span').addEventListener('click', e => addSubscription())

      const startingData = getValues()
      const chart = new Chart($chart, {
        type: 'line',
        data: {
          labels: calculateData(sales => `$${addCommas(sales)}`),
          datasets: [{
            label: 'Business Costs',
            data: calculateData(calculateCosts),
            backgroundColor: 'rgba(54, 162, 235, 0.0)',
            borderColor: '#8692ce',
          }, {
            label: 'Revenue',
            data: calculateData(calculateRevenue),
            backgroundColor: 'rgba(255, 99, 132, 0.0)',
            borderColor: 'rgba(255, 99, 132, 1)',
          }],
        },
        options: {
          scales: {
            yAxes: [{ticks: {callback: v => `$${v}/mo`}}],
          }
        }
      })

      addSubscription("Point of sale and inventory management", 119)
      addSubscription("Accounting software", 15)
      addSubscription("e-commerce software", 29)
    </script>
  </body>
</html>
