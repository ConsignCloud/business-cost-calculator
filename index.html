<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/352687b833.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      * {
        font-family: 'Montserrat', sans-serif;
      }

      tr {
        height: 3em;
      }
    </style>
  </head>
  <body class="text-gray-900 max-w-4xl m-auto">
    <!--
    <h1 class="text-4xl text-center my-12 font-bold">
      ConsignCloud Business Cost Calculator
    </h1>
    <div class="my-8 mb-16 p-8 border border-solid border-gray-400
                bg-gray-100 rounded shadow">
      <p class="pb-4">Trying to see what it'll cost to open a consignment store?</p>
      <p>
        Enter your expected itemized costs below, and we'll calculate how much it will
        cost you per month to run - and how soon you'll be profitable.
      </p>
    </div>
    -->
    <div class="flex flex-col gap-8">
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl pb-2 border-b border-solid border-gray-200">
          Business Costs
        </h2>
        <table class="w-full">
          <tbody>
            <tr>
              <td>Lease</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="lease"
                  value="1200" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
              </td>
            </tr>
            <tr>
              <td>Utilities</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="utilities"
                  value="400" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
              </td>
            </tr>
            <tr>
              <td>
                Business owner's policy
                <a
                  href="https://www.investopedia.com/terms/business-owners-policy.asp"
                  target="_blank"
                  rel="noopener">
                  <i class="fa-xs fa-solid fa-circle-info text-teal-300 cursor-pointer"></i>
                </a>
              </td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="insurance"
                  value="1200" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/yr</span>
              </td>
            </tr>
            <tr>
              <td>
                Worker's compensation insurance
                <a
                  href="https://www.benzinga.com/money/workers-comp-calculator"
                  target="_blank"
                  rel="noopener">
                  <i class="fa-xs fa-solid fa-circle-info text-teal-300 cursor-pointer"></i>
                </a>
              </td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="workersComp"
                  value="1275" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/yr</span>
              </td>
            </tr>
            <tr>
              <td>Employee wages</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="payroll"
                  value="5000" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl pb-2 border-b border-solid border-gray-200">
          Payment processing
        </h2>
        <h3 class=" mt-2">What is your average sale amount?</h3>
        <div class="flex">
          <div class="mr-4">$1</div>
          <input
            class="w-full"
            type="range"
            min="1"
            max="1000"
            value="80"
            name="avgSale">
          <div class="ml-4">$1,000</div>
        </div>
        <div id="avgSaleDisplay" class="text-center">$80</div>
        <table class="w-full">
          <tbody>
            <tr>
              <td>Monthly subscription</td>
              <td class="relative text-right">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="paymentSubscription"
                  value="0" />
                <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
              </td>
            </tr>
            <tr>
              <td>Flat fee</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="paymentFee"
                  value="0.30"
                  step="0.1" />
              </td>
            </tr>
            <tr>
              <td>Fee rate</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">%</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="paymentRate"
                  value="2.6"
                  step="0.1" />
              </td>
            </tr>
            <tr>
              <td>Sales tax</td>
              <td class="text-right relative">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">%</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="salesTax"
                  value="5" />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl pb-2 border-b border-solid border-gray-200">
          Inventory Costs
        </h2>
        <h3 class="mt-2">How much do you spend on inventory?</h3>
        <p>
          Many resale shops operate using a consignment cost model, making it very easy
          to anticipate how much each sale will cost you. If you use retail or buy-outright
          rather than consignment, calculate your average COGS as a percentage of sales.
        </p>
        <div class="flex">
          <div class="mr-4">0</div>
          <input
            class="w-full"
            type="range"
            min="0"
            max="100"
            value="50"
            name="consignorSplit">
          <div class="ml-4">100</div>
        </div>
        <div id="consignorSplitDisplay" class="text-center">50%</div>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl pb-2 border-b border-solid border-gray-200">
          Payout Processing
        </h2>
        <h3 class="mt-2">How many payouts do you process per month?</h3>
        <p>
          A quick way to calculate this - take your number of active accounts
          (usually around 20% of the total), and divide by how often you process payouts.
          For example if you have 30 active accounts, and you pay out once every 3 months,
          you would be processing 10 payouts per month.
        </p>
        <div class="flex">
          <div class="mr-4">10</div>
          <input
            class="w-full"
            type="range"
            min="10"
            max="300"
            value="50"
            name="payoutsPerMonth">
          <div class="ml-4">300</div>
        </div>
        <div id="payoutsPerMonthDisplay" class="text-center">50</div>
        <table class="w-full">
          <tbody>
            <tr>
              <td>Cost per payout</td>
              <td class="relative text-right">
                <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
                <input
                  class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
                  type="number"
                  name="payoutCost"
                  step="0.1"
                  value="1.00" />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl pb-2 border-b border-solid border-gray-200">
          Additional Monthly Expenses
        </h2>
        <table class="w-full" id="subscriptions">
          <tbody>
            <tr id="addSubscription">
              <td colspan="2" class="cursor-pointer">
                <span>
                  <i class="fa-solid fa-plus cursor-pointer mx-2"></i> Add an expense
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex flex-col gap-4">
        <h2 class="text-2xl pb-2 border-b border-solid border-gray-200">
          Your Results
        </h2>
        <div>
          <canvas id="chart"></canvas>
        </div>
        <div class="my-8 mb-16 p-8 border border-solid border-gray-400
                    bg-gray-100 rounded shadow">
          <p class="pb-4">
            The chart above shows how your business costs will scale with your sales volume
            on a monthly basis. The point at which the red line rises above the rest represents
            your break-even point. Everything to the right of that point is profit; everything to
            the left is loss.
          </p>
        </div>
      </div>
    </div>
    <script>
      // Variables

      const $ = s => document.querySelector(s)
      const $$ = s => document.querySelectorAll(s)
      const $chart = $('#chart')
      const $inputs = [].slice.apply($$('input[name]'))
      const $subscriptions = $('#subscriptions')

      // Functions

      const initArray = (l, f) => {
        const a = []

        for (let i = 1; i < l; i++) {
          a.push(f(i))
        }

        return a
      }

      const addCommas = x => x.toString().replace(/(\d)(?=(\d{3})+$)/g, '$1,')

      const getValues = () => {
        const values = {}

        $inputs.forEach($input=> {
          values[$input.name] = parseFloat($input.value)
        })

        return values
      }

      const calculateCosts = sales => {
        const {
          avgSale, insurance, lease, utilities, paymentFee, paymentRate, salesTax,
          paymentSubscription, payroll, salesVolume, workersComp, payoutsPerMonth,
          payoutCost, consignorSplit,
        } = getValues()

        const subscriptions = [].slice
          .apply($$('[name="subscription[]"]'))
          .reduce((t, $i) => t + parseFloat($i.value), 0)

        return {
          'Business, Insurance, and Subscriptions': (
            subscriptions + lease + utilities + payroll + (insurance + workersComp) / 12
          ),
          'Payment and Payout Processing': (
            (sales / avgSale) * paymentFee
            + sales * (paymentRate / 100)
            + paymentSubscription
            + sales * (salesTax / 100)
            + payoutsPerMonth * payoutCost
          ),
          'Inventory Cost': sales * (consignorSplit / 100),
        }
      }

      const calculateSales = () => initArray(31, i => i * 1000)

      const calculateDatasets = () => {
        const sales = calculateSales()
        const costs = sales.map(x => calculateCosts(x))

        const colors = {
          'Inventory Cost': 'rgba(134, 146, 206, 1)',
          'Payment and Payout Processing': 'rgba(242, 158, 76, 1)',
          'Business, Insurance, and Subscriptions': 'rgba(97, 208, 149, 1)',
        }

        const fills = {
          'Inventory Cost': '#E7E9F4',
          'Payment and Payout Processing': '#FAECDE',
          'Business, Insurance, and Subscriptions': '#E5F5EB',
        }

        const keys = Array.from(Object.keys(colors))

        keys.reverse()

        return [{
          label: 'Revenue',
          data: sales,
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
        }].concat(
          keys
            .map((k, i) => ({
              label: k,
              stack: 'cost',
              fill: true,
              data: costs.map(x => Math.round(x[k])),
              backgroundColor: fills[k],
              borderColor: colors[k],
            }))
        )
      }

      const updateChart = () => {
        calculateDatasets().forEach(({data}, i) => {
          chart.data.datasets[i].data = data
        })

        chart.update()
      }

      const addSubscription = (name = '', amount = 0) => {
        const n = $subscriptions.querySelectorAll('tr').length
        const $tr = document.createElement('tr')

        $tr.innerHTML = `
        <td>
          <i class="fa fa-times cursor-pointer mx-2"></i>
          <input
            class="border border-solid border-gray-400 rounded p-2 w-3/4"
            placeholder="Subscription name"
            value="${name}" />
        </td>
        <td class="relative text-right">
          <span class="inline-block w-6 -mr-8 pr-2 z-10 relative text-gray-600">$</span>
          <input
            class="border border-solid border-gray-400 rounded p-2 w-32 pl-6"
            name="subscription[]"
            type="number"
            value="${amount}" />
          <span class="inline-block absolute z-10 -ml-16 right-8 top-3 opacity-75 w-4">/mo</span>
        </td>`

        $tr.querySelector('input[name]').addEventListener('change', updateChart)
        $tr.querySelector('.fa-times').addEventListener('click', () => {
          $tr.remove()

          updateChart()
        })

        $subscriptions.append($tr)
        $subscriptions.append($('#addSubscription'))

        updateChart()
      }

      // Initialization

      $inputs.forEach($input => {
        $input.addEventListener('change', updateChart)
      })

      $('[name=avgSale]').addEventListener('input', e => {
        $('#avgSaleDisplay').innerHTML = `$${addCommas(getValues().avgSale)}`
      })

      $('[name=payoutsPerMonth]').addEventListener('input', e => {
        $('#payoutsPerMonthDisplay').innerHTML = addCommas(getValues().payoutsPerMonth)
      })

      $('[name=consignorSplit]').addEventListener('input', e => {
        $('#consignorSplitDisplay').innerHTML = `${getValues().consignorSplit}%`
      })

      $('#addSubscription span').addEventListener('click', e => addSubscription())

      const startingData = getValues()
      const chart = new Chart($chart, {
        type: 'line',
        data: {
          labels: calculateSales(sales => `$${addCommas(sales)}`),
          datasets: calculateDatasets(),
        },
        options: {
          interaction: {
            mode: 'index',
            intersect: false,
          },
          scales: {
            x: {
              ticks: {
                callback: function(x) {
                  return'$' + addCommas(this.getLabelForValue(x))
                },
              },
            },
          },
          plugins: {
            tooltip: {
              callbacks: {
                title: ([revenue, ...other]) => {
                  const cost = other.reduce((t, x) => t + x.raw, 0)

                  return 'Profit: $' + addCommas(revenue.raw - cost)
                },
                label: context => {
                  return `${context.dataset.label}: $${context.formattedValue}`
                },
              },
            },
          },
        }
      })

      addSubscription("Point of sale and inventory management", 119)
      addSubscription("Accounting software", 15)
      addSubscription("e-commerce software", 29)
    </script>
  </body>
</html>
